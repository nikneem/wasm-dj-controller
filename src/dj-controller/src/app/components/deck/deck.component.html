<div class="deck-container" [class.deck-left]="deckSide === 'left'" [class.deck-right]="deckSide === 'right'">
    <!-- LCD Display Screen -->
    <div class="lcd-display">
        <div class="lcd-header">
            <div class="lcd-deck-number">DECK {{ deckNumber }}</div>
            <div class="lcd-status">
                <span class="status-indicator" [class.playing]="isPlaying"></span>
                <span class="status-text">{{ isPlaying ? 'PLAYING' : isCued ? 'CUED' : 'STOPPED' }}</span>
            </div>
        </div>

        <div class="lcd-track-info">
            <div class="track-title">{{ trackTitle }}</div>
            <div class="track-artist" *ngIf="artist">{{ artist }}</div>
        </div>

        <div class="lcd-waveform">
            <div class="waveform-container">
                <div class="waveform-bar" *ngFor="let height of waveformBars; let i = index" [style.height.%]="height">
                </div>
                <div class="playhead"></div>
            </div>
        </div>

        <div class="lcd-footer">
            <div class="time-display">
                <span class="current-time">{{ currentTime }}</span>
                <span class="separator">/</span>
                <span class="total-time">{{ duration }}</span>
            </div>
            <div class="track-meta">
                <span class="bpm" *ngIf="bpm > 0">{{ bpm }} BPM</span>
                <span class="key" *ngIf="key">{{ key }}</span>
            </div>
        </div>
    </div>

    <!-- Loop Controls -->
    <div class="loop-controls">
        <button pButton label="A" class="loop-btn loop-a" [class.active]="loopStart !== null"
            (click)="onSetLoopPoint('A')">
        </button>
        <button pButton label="B" class="loop-btn loop-b" [class.active]="loopEnd !== null"
            (click)="onSetLoopPoint('B')">
        </button>
        <button pButton label="REPEAT" class="loop-btn loop-repeat" [class.active]="isLooping"
            [disabled]="loopStart === null || loopEnd === null" (click)="onToggleLoop()">
        </button>
        <button pButton label="EXIT" class="loop-btn loop-exit" [disabled]="!isLooping" (click)="onExitLoop()">
        </button>
    </div>

    <!-- Main Control Area -->
    <div class="main-controls">
        <!-- Transport Controls (Left) -->
        <div class="transport-controls">
            <button class="transport-btn cue-btn" [class.active]="isCued" (click)="onCue()">
                <div class="led-rim led-orange" [class.lit]="isCued"></div>
                <span class="btn-label">CUE</span>
            </button>
            <button class="transport-btn play-btn" [class.active]="isPlaying" [class.paused]="isPaused"
                (click)="onPlayPause()">
                <div class="led-rim led-green" [class.lit]="isPlaying" [class.flashing]="isPaused"></div>
                <i class="pi" [class.pi-play]="!isPlaying" [class.pi-pause]="isPlaying"></i>
            </button>
        </div>

        <!-- Jog Wheel (Center) -->
        <div class="jog-wheel-container">
            <div class="jog-wheel" [class.touched]="isJogTouched" [style.transform]="'rotate(' + jogRotation + 'deg)'"
                (mousedown)="onJogMouseDown()" (mouseup)="onJogMouseUp()" (mousemove)="onJogRotate($event)">
                <div class="jog-wheel-surface">
                    <div class="jog-center-dot"></div>
                    <div class="jog-marking" *ngFor="let mark of [0,1,2,3,4,5,6,7]"
                        [style.transform]="'rotate(' + (mark * 45) + 'deg)'">
                    </div>
                </div>
                <div class="jog-rim"></div>
            </div>
            <div class="jog-label">JOG WHEEL</div>
        </div>

        <!-- Tempo Control (Right) -->
        <div class="tempo-control">
            <div class="tempo-label">TEMPO</div>
            <div class="tempo-display">{{ tempoPercent }}</div>
            <div class="tempo-slider-container">
                <p-slider [(ngModel)]="tempoValue" [min]="-8" [max]="8" [step]="0.01" orientation="vertical"
                    (onChange)="onTempoChange(tempoValue)" class="tempo-slider">
                </p-slider>
                <div class="tempo-markers">
                    <span class="marker">+8</span>
                    <span class="marker center">0</span>
                    <span class="marker">-8</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Track Button / Drag Drop Area -->
    <div class="deck-footer" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)"
        [class.drag-over]="isDragOver" [class.locked]="isPlaying">

        <!-- When playing: Show locked state -->
        <div *ngIf="isPlaying" class="load-track-locked">
            <i class="pi pi-lock"></i>
            <span>LOCKED</span>
        </div>

        <!-- When not playing: Show load track area -->
        <div *ngIf="!isPlaying" class="load-track-area">
            <div *ngIf="!loadedFileName" class="load-track-empty">
                <button pButton label="LOAD TRACK" icon="pi pi-folder-open" class="p-button-outlined load-track-btn"
                    (click)="onLoadTrack()">
                </button>
                <p class="drag-hint">or drag an MP3 file here</p>
            </div>
            <div *ngIf="loadedFileName" class="load-track-loaded">
                <div *ngIf="isAnalyzing" class="analyzing-indicator">
                    <i class="pi pi-spin pi-spinner"></i>
                    <span>Analyzing...</span>
                </div>
                <div *ngIf="!isAnalyzing" class="loaded-content">
                    <i class="pi pi-check-circle"></i>
                    <span class="track-name">{{ loadedFileName }}</span>
                    <div *ngIf="bpm > 0" class="analysis-results">
                        <span class="analysis-badge">{{ bpm }} BPM</span>
                        <span class="analysis-badge">{{ key }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error message -->
        <div *ngIf="dragError" class="load-track-error">
            <i class="pi pi-exclamation-circle"></i>
            <span>{{ dragError }}</span>
        </div>
    </div>
</div>